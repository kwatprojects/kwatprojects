---
title: "Exploring and Wrangling Fitbit data"
author: "Katie Wat"
date: "2023-09-27"
output: html_document
---

&nbsp;
&nbsp;

This dataset is available publicly on [Kaggle](https://www.kaggle.com/datasets/arashnic/fitbit/data).


```{r setup, include = FALSE}
library(ggpubr)
library(tidyverse)
library(RColorBrewer)

setwd("/Users/katiewat/Documents/DataCourses/Coursera/Fitabase")

getwd()

dailyActivity <- read.csv("dailyActivity_merged.csv")
```



&nbsp;
&nbsp;

## Setting up the dataset

1. Examine data struture 
2. Set ***Id*** as a factor
```{r data structure, warning = FALSE}
glimpse(dailyActivity) # examine data structure


dailyActivity$Id <- as.factor(dailyActivity$Id) # set Id as factor
```


&nbsp;
&nbsp;

## Take a first look at the dataset

```{r data 1st look}
# How many participant were there? 
n_ppt <- dailyActivity %>% 
  summarize(n_ppt = n_distinct(Id))

# How many days did participants logged their data? 
Range <- dailyActivity %>% 
  group_by(Id) %>%
  summarize(n_days = n_distinct(ActivityDate)) %>%
  summarize(min_days = min(n_days), max_days = max(n_days), med_days = median(n_days))

```

- There are **`r n_ppt$n_ppt`** in this study.
- Participants recorded between **`r Range$min_days`** and **`r Range$max_days`** days, with a median of **`r Range$med_days`** days.

&nbsp;
&nbsp;
&nbsp;

## How much time did participants spent being active daily?

### 1. Prepare dataframes
1. Transform dataframe from wide to narrow, bringing all ***Activity Intensity*** in first column, and its respective minutes ***ActivityMinutes*** in the second column.
2. Set ***Activity Intensity*** as a factor.
3. Rename levels within ***Activity Intensity***.

```{r ActivityMinutes, warning = FALSE, message = FALSE}

# reshape dataframe from wide to narrow, displaying activity intensity and their respective minutes
# set activity intensity as factor, and change levels names
ActivityMinutes <- dailyActivity %>%
  pivot_longer(cols = 11:14, names_to = "ActivityIntensity", values_to = "ActivityMinutes") %>%
  mutate(ActivityIntensity =  factor(ActivityIntensity, levels = c(unique(ActivityIntensity))), 
         ActivityIntensity = fct_recode(ActivityIntensity, Sedentary = "SedentaryMinutes", 
                                        LightlyActive = "LightlyActiveMinutes",
                                        FairlyActive = "FairlyActiveMinutes",
                                        VeryActive = "VeryActiveMinutes"))
```
 
&nbsp;
&nbsp;

4. Filter out ***Sedentary*** activity, so we don't include any minutes that were sedentary.
5. Find total activity minutes by participant and date, which is the sum of ***LightlyActive***, ***FairlyActive*** and ***VeryActive*** minutes.
6. Calculate **summary statistics** on the duration of activity as a whole.


``` {r Act_stats, warning = FALSE, message = FALSE}
# How many minutes of activity did participants logged?   
Act_stats<- ActivityMinutes %>%
  filter(ActivityIntensity != "Sedentary") %>%
  group_by(Id, ActivityDate) %>%
  summarize(Total_Act_min = sum(ActivityMinutes), cnt = n_distinct(ActivityMinutes)) %>%
  ungroup() %>%
  summarize(Min_Act_min = min(Total_Act_min), Med_Act_min = median(Total_Act_min), 
            Avg_Act_min = round(mean(Total_Act_min),0), Max_Act_min = max(Total_Act_min))

```


#### Summary statistics on duration of activities (minutes)

- Minimum: `r Act_stats$Min_Act_min`
- Median: `r Act_stats$Med_Act_min`
- Maximum: `r Act_stats$Max_Act_min`
- Mean: `r Act_stats$Avg_Act_min`

We will use the mean value for the plot below to see how each participant compares to the average time spent being active.

&nbsp;
&nbsp;

### 2. Make some plots

#### 1. Histogram of average daily activity duration
```{r [plot] Histogram ActivityMinutes, warning=FALSE, message=FALSE}
# [plot] histogram of activity duration
ActivityMinutes %>%
  filter(ActivityIntensity != "Sedentary") %>%
  group_by(Id, ActivityDate) %>%
  summarize(total_act_mins = sum(ActivityMinutes)) %>%
  ungroup() %>%
  group_by(Id) %>%
  summarize(avg_act_mins = round(mean(total_act_mins), 1)) %>%
  
  ggplot(aes(x = avg_act_mins))+ 
  geom_histogram(binwidth = 60, color = "grey30", fill = "gold2", alpha = 0.8)+
  scale_x_continuous("Average active minutes per day", breaks = seq(0,360,60), limits = c(0,360))+
  scale_y_continuous("Number of participants", breaks = seq(0,12,2), limits = c(0,12))+
  labs(title = "Distribution of daily activity duration")+
  theme_classic()+
  theme(axis.title.x = element_text(size=12),
        axis.title.y = element_text(size = 12),
        title = element_text( size = 14))
```
&nbsp;

- On average, participants spent between 60 to 360 minutes (1-6 hours) being active daily.
- Most participants spent more than 240 minute (>4 hours) being active daily.

&nbsp;

#### 2. Average daily activity duration by each participant, sorted by the activity duration
```{r [plot] ActivityMinutes, warning = FALSE, message=FALSE}

# [plot] Average active minutes per day by participant
ActivityMinutes %>%
  filter(ActivityIntensity != "Sedentary") %>%
  group_by(Id, ActivityIntensity) %>%
  summarize(avg_act_mins = mean(ActivityMinutes)) %>% # avg active minutes by activity intensity and person across days
  
  ggplot(aes(x = fct_reorder(Id, avg_act_mins, .fun=sum), y = avg_act_mins))+
  geom_col(aes(fill = ActivityIntensity), alpha = 0.8)+
  geom_hline(yintercept = Act_stats$Avg_Act_min, linetype="dashed", color = "grey30")+
  scale_y_continuous("Average active minutes per day", breaks = seq(0,360,60), limits = c(0,360))+
  scale_x_discrete("Participant")+
  labs(title = "Daily activity duration by participant")+
  scale_fill_brewer(palette = "YlOrRd", direction = -1)+
  geom_text(aes(6, Act_stats$Avg_Act_min, label = paste("mean = ", Act_stats$Avg_Act_min), vjust = -0.5), color = "grey30", size = 4)+
  theme_classic()+
  theme(axis.text.x = element_blank(),
        axis.title.x = element_text(size=12),
        axis.title.y = element_text(size = 12),
        title = element_text( size = 14))

```

&nbsp;

- A large proportion of their daily activity was in **light intensity**.

&nbsp;
&nbsp;

## Next Steps

- Explore more on activity data, discover any daily/ weekly activity patterns.
- Explore from other data tables, including **Sleep Hours** and **Step Count**.

&nbsp;
&nbsp;
